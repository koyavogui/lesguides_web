import{Q as L}from"./QPage.6503ee05.js";import{Y as D,Z as E,i as b,r as g,n as Q,at as O,_ as S,a0 as Y,o as c,c as h,w as a,a2 as l,b as o,ah as m,ag as v,aN as z,aO as H,aP as K,as as N,a5 as q,q as Z,a as f,a1 as $,aj as C,a4 as G,ai as W,$ as X}from"./index.3698d03c.js";import{e as I,h as A,k as U,C as x,c as F,i as ee,r as te,m as J,S as se,l as oe,n as ae,o as ie}from"./SortableButtonsComponent.2dea1bfa.js";import{Q as ne}from"./QScrollArea.76c6595f.js";import{a as w,b as re,c as le,Q as T}from"./QCard.46c77733.js";import{b as j,Q as k,a as B}from"./QItem.7508c887.js";import{B as de,S as ue}from"./smalCard.cdf24b58.js";import"./use-dark.f48971e5.js";import"./use-timeout.3f01649d.js";const me=D({emit:["v-close-popup"],props:{hasEdit:{type:Boolean,default:()=>!1}},setup(e,{emit:t}){const u=E.getItem("lesguides_userConnected");let i=b("items/regions"),n=b("items/districts");const d=b("users");let s=g({}),r=g(null);const _=async()=>{i.limit.value=[],i.sort.value="nom_region",i.filters.value={deleted:{_eq:!1}},await i.getItems()},y=async(P,M,V)=>{if(console.log("je suis ici"),d.limit.value=50,d.filters.value={_and:[{role:{_eq:u.role}},{id:{_neq:u.id}},{troupe:{districts:{regions:s.value.regions.id}}},{titre:{niveau:{_gt:4}}}]},d.fields.value="id, avatar, contact, email, first_name, last_name, profession, genre.*, genre.branches.*, genre.branches.grades.*,branche.*, branche.grades.*,grade.*,troupe.*, troupe.districts.*, troupe.districts.list_troupe.*, troupe.districts.regions.*,troupe.districts.regions.list_district.*,troupe.districts.regions.list_district.list_troupe.*,titre.*,situation_matrimonial.* ",await d.getItems(),r.value=d.items.value,console.log("list_user",r.value),r.value!==null){M();return}};return Q(()=>{console.log("list_user",n.item.value),_(),e.hasEdit&&(s.value=n.item.value)}),{assetsUrl:O,formData:s,stateRegion:i,stateUser:d,list_user:r,fetchDataUser:y,onSubmit:async()=>{Y("info","addDistrict | onSubmit",s.value),n.item.value=s.value,e.hasEdit?await n.update():await n.create(),t("VClosePopup")}}}}),ce={class:"row"},pe={class:"text-h2 q-py-xs"},ge={class:"text-bold text-uppercase"};function _e(e,t,u,i,n,d){return c(),h(T,{class:"my-card",style:{"min-width":"70vw","border-radius":"0.8rem"}},{default:a(()=>[l("section",ce,[o(w,{class:"col-md-4 col-sm-12 flex flex-center bg-green-10 no-padding text-green-2 text-bold"},{default:a(()=>[o(I,{src:"district.jpg","spinner-color":"primary","spinner-size":"82px",height:"100%",fit:"cover"})]),_:1}),o(w,{class:"col-md-8 col-sm-12"},{default:a(()=>[l("div",pe,m(e.hasEdit?"Modification":"Ajout")+" de district ",1),o(re,{class:""},{default:a(()=>[o(w,{class:"q-gutter-sm"},{default:a(()=>[o(A,{modelValue:e.formData.regions,"onUpdate:modelValue":[t[0]||(t[0]=s=>e.formData.regions=s),t[1]||(t[1]=s=>e.formData.cd_actuel=null)],options:e.stateRegion.items.value,"option-value":"options","option-label":"nom_region",label:"R\xE9gion maraine",color:"green-10",class:"bg-green-1 q-pl-sm",style:{"border-radius":"0.8rem"},rounded:"",borderless:"","options-dense":"","transition-show":"jump-down","transition-hide":"jump-up","transition-duration":"500"},null,8,["modelValue","options"]),o(le,{modelValue:e.formData.nom_district,"onUpdate:modelValue":t[2]||(t[2]=s=>e.formData.nom_district=s),type:"text",label:"Nom du district",color:"green-10",class:"bg-green-1 q-pl-sm",style:{"border-radius":"0.8rem"},rounded:"",borderless:""},null,8,["modelValue"]),e.formData.regions?(c(),h(A,{key:0,modelValue:e.formData.cd_actuel,"onUpdate:modelValue":t[3]||(t[3]=s=>e.formData.cd_actuel=s),options:e.list_user,label:"Commissaire de district actuelle",color:"green-10",class:"bg-green-1 q-pl-sm",style:{"border-radius":"0.8rem"},"option-value":"id",onFilter:e.fetchDataUser,"option-label":s=>s===null?"Null value":s.first_name+" "+s.last_name,rounded:"",borderless:""},{"no-option":a(()=>[o(j,null,{default:a(()=>[o(k,{class:"text-italic text-grey"},{default:a(()=>[v(" Aucun membre avec le titre disponible ")]),_:1})]),_:1})]),option:a(s=>[o(j,z(H(s.itemProps)),{default:a(()=>[o(k,{avatar:""},{default:a(()=>[o(K,{color:"green-1"},{default:a(()=>[s.opt.avatar?(c(),h(I,{key:0,"spinner-color":"white",src:e.assetsUrl+s.opt.avatar+"?fit=cover&width=100&height=100&quality=25"},null,8,["src"])):(c(),h(I,{key:1,src:"icons/boy-scout.png",fit:"cover",ratio:1,width:"40%"}))]),_:2},1024)]),_:2},1024),o(k,null,{default:a(()=>[o(B,null,{default:a(()=>[l("span",ge,m(s.opt.titre.libelle),1),v(" "+m(s.opt.first_name)+" "+m(s.opt.last_name),1)]),_:2},1024),v(" "+m(s.opt.troupe.districts.regions.nom_region)+" ",1),o(B,{caption:""},{default:a(()=>[v(m(s.opt.troupe.nom_troupe),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter","option-label"])):N("",!0)]),_:1}),o(U,{align:"right"},{default:a(()=>[o(q,{label:"Enregistrer","no-caps":"",unelevated:"",color:"green-10",padding:"sm lg",style:{"border-radius":"0.8rem"},onClick:e.onSubmit},{default:a(()=>[v(m(e.hasEdit?"Sauvegarder":"Enregistrer"),1)]),_:1},8,["onClick"]),Z(o(q,{label:"Annuler",outline:"",padding:"sm lg",type:"reset",color:"green-8","no-caps":"",onClick:t[4]||(t[4]=s=>e.formData={}),style:{"border-radius":"0.8rem"}},null,512),[[x]])]),_:1})]),_:1})]),_:1})])]),_:1})}var R=S(me,[["render",_e]]);const fe=D({components:{addComponent:R},props:{item:{type:Object,required:!0}},emit:["v-close-popup"],setup(e,{emit:t}){let u=b("items/districts");const i=g(!1);let n=()=>{i.value=!i.value,u.item.value=e.item};return Q(async()=>{}),{onEdit:n,editShow:i}}});function ve(e,t,u,i,n,d){const s=f("add-component");return c(),$(C,null,[o(q,{flat:"",icon:"o_edit",color:"green-10",onClick:t[0]||(t[0]=r=>e.onEdit())}),o(F,{modelValue:e.editShow,"onUpdate:modelValue":t[2]||(t[2]=r=>e.editShow=r)},{default:a(()=>[o(s,{hasEdit:"",onVClosePopup:t[1]||(t[1]=r=>e.editShow=!e.editShow)})]),_:1},8,["modelValue"])],64)}var be=S(fe,[["render",ve]]);const he=D({components:{editComponent:be,BrancheState:de,SmalCard:ue,deleteBtnComponent:ee},props:{item:{type:Object,required:!0}},setup(e){let t=b("items/districts");const u=b("items/troupes"),i=b("users");let n=g(0),d=g({days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],daysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],months:["Janvier","Fevrier","Mars","Avril","Mai","Juin","Juillet","Ao\xFBt","Septembre","Octobre","Novembre","D\xE9cembre"],monthsShort:["Jan","Fev","Mar","Avr","Mai","Ju","Juil","Ao\xFBt","Sept","Oct","Nov","Dec"]});const s=g(),r=g(!1),_=g(!1),y=V=>{t.item.value=V,r.value=!r.value},p=async V=>{t.item.value=V,_.value=!_.value},P=async()=>{u.filters.value={_and:[{deleted:{_eq:"false"}},{districts:{_eq:e.item.id}}]},await u.count(),s.value=u.totalItem.value};let M=async()=>{console.log("id du disttrict ",e.item.id),i.filters.value={_and:[{troupe:{districts:e.item.id}},{deleted:!1}]},n.value=await i.count(),console.log("id du disttrict ",n.value)};return Q(async()=>{P(),M()}),{showDeleted:_,nombreTroupe:s,deleteItem:p,editShow:r,editItem:y,options:d,date:te,totalMembre:n}}}),ye={class:"text-h5 text-center"},we={class:"row q-mt-sm text-center"},$e={class:"col"},Ce={class:"text-uppercase"},De={class:"col text-subtitle2"},Se={class:"row justify-center"},Ve={class:"col-5 q-pa-xs"},qe={class:"col-6 q-pa-xs"},Qe={class:"col-12 q-pa-xs"},Me={class:"row text-grey-8 text-weight-thin items-center q-pl-sm text-italic"};function Ie(e,t,u,i,n,d){const s=f("smal-card"),r=f("branche-state"),_=f("edit-component"),y=f("delete-btn-component");return c(),h(T,{class:"my-card q-pa-xs",flat:"",style:{"border-radius":"0.8rem"}},{default:a(()=>[o(w,null,{default:a(()=>[l("div",ye,m(e.item.nom_district),1),l("div",we,[l("div",$e,[e.item.cd_actuel?(c(),$(C,{key:0},[l("span",Ce,m(e.item.cd_actuel.titre.libelle)+" : ",1),v(" "+m(e.item.cd_actuel.last_name)+" "+m(e.item.cd_actuel.first_name),1)],64)):(c(),$(C,{key:1},[v(" - ")],64))]),l("div",De,[o(G,{name:"r_fort",size:"sm"}),v(" : "+m(e.item.regions?e.item.regions.nom_region:"-"),1)])])]),_:1}),o(w,null,{default:a(()=>[l("div",Se,[l("div",Ve,[o(s,{iconName:"r_push_pin",textToView:e.item.list_troupe.length},null,8,["textToView"])]),l("div",qe,[o(s,{iconName:"r_groups_2",textToView:e.totalMembre},null,8,["textToView"])]),l("div",Qe,[o(r,{service:"items/districts",searchKey:e.item.id,district:""},null,8,["searchKey"])])])]),_:1}),l("div",Me,[v(m(e.date.formatDate(e.item.date_created,"D MMMM YYYY",e.options))+" ",1),o(J),o(U,{align:"right"},{default:a(()=>[o(_,{item:e.item},null,8,["item"]),o(y,{model:"items/districts",libelle:e.item.nom_district,item:e.item},null,8,["libelle","item"])]),_:1})])]),_:1})}var ke=S(he,[["render",Ie]]);const Pe=D({components:{itemComponent:ke,AddComponent:R,SearchComponent:se,SortableButtonsComponent:oe},setup(){const e=g(!1);let t=b("items/districts"),u=g(),i=g(1),n=b("items/branches"),d=()=>Math.ceil(t.totalItem.value/8);const s=async()=>{t.limit.value=8,t.sort.value="-date_created",t.fields.value="*,regions.*, cd_actuel.*, cd_actuel.titre.libelle",t.filters.value={deleted:{_eq:!1}},await t.getItems(),d(),await n.getItems()};return Q(async()=>{t.page.value=1,s()}),{addComponentHide:async()=>{await s(),e.value=!1},pagination:async()=>{await t.getItems()},paginationCount:d,currentPage:i,total_count:u,addShow:e,stateDistrict:t}}}),Ae={class:"q-mt-md no-padding"},je={class:"text-h6"},Be={class:"row q-px-xs q-gutter-x-sm"},Ee={class:"row"};function Ne(e,t,u,i,n,d){const s=f("sortable-buttons-component"),r=f("search-component"),_=f("item-component"),y=f("add-component");return c(),$(C,null,[l("section",Ae,[l("div",je," List des district ( "+m(e.stateDistrict.totalItem.value)+" ) ",1),l("div",Be,[o(q,{class:"rounded-borders",unelevated:"",color:"green-6","no-caps":"",icon:"r_add",label:"Ajouter",padding:"sm md",onClick:t[0]||(t[0]=p=>e.addShow=!e.addShow)}),o(s,{model:"items/districts",sortedField:"nom_district"}),o(J),o(r,{model:"items/districts",filterField:"nom_district",libelle:"Rechercher un district"}),e.paginationCount()>1?(c(),h(ae,{key:0,unelevated:"","active-design":"unelevated","active-color":"green-5",color:"green-2",modelValue:e.stateDistrict.page.value,"onUpdate:modelValue":[t[1]||(t[1]=p=>e.stateDistrict.page.value=p),t[2]||(t[2]=p=>e.pagination())],"boundary-numbers":!1,"max-pages":5,max:e.paginationCount()},null,8,["modelValue","max"])):N("",!0)]),o(ne,{class:"q-mt-sm",style:{height:"79vh"}},{default:a(()=>[l("template",Ee,[(c(!0),$(C,null,W(e.stateDistrict.items.value,p=>(c(),h(ie,{key:p.id,once:"",class:"col-lg-3 col-md-4 col-sm-6 q-pa-xs",transition:"scale"},{default:a(()=>[o(_,{item:p},null,8,["item"])]),_:2},1024))),128))])]),_:1})]),o(F,{modelValue:e.addShow,"onUpdate:modelValue":t[4]||(t[4]=p=>e.addShow=p)},{default:a(()=>[o(y,{onVClosePopup:t[3]||(t[3]=p=>e.addComponentHide())})]),_:1},8,["modelValue"])],64)}var Ue=S(Pe,[["render",Ne]]);const Fe=D({components:{itemsComponent:Ue},name:"districtPage",setup(){const e=X();E.has("lesguides_userConnected")||e.push("/")}});function Je(e,t,u,i,n,d){const s=f("items-component");return c(),h(L,{padding:""},{default:a(()=>[o(s)]),_:1})}var Ge=S(Fe,[["render",Je]]);export{Ge as default};
