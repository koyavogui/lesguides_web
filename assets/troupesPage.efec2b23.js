import{Q as te}from"./QPage.6503ee05.js";import{aQ as oe,aB as se,aR as ae,n as Q,k as w,ac as ne,ar as L,aC as ie,ab as le,Y as A,i as $,r as _,Z as Y,at as re,_ as M,o as p,c as b,w as n,a2 as m,b as o,ah as c,ag as v,as as E,aN as de,aO as ue,aP as me,a5 as P,q as ce,a as h,a1 as k,aj as O,a4 as T,ai as pe,$ as ge}from"./index.3698d03c.js";import{e as R,h as j,k as G,C as fe,c as H,i as ve,r as _e,m as Z,S as be,l as he,n as Ce,o as ye}from"./SortableButtonsComponent.2dea1bfa.js";import{Q as $e}from"./QScrollArea.76c6595f.js";import{a as q,b as we,c as Se,Q as K}from"./QCard.46c77733.js";import{b as U,Q as I,a as B}from"./QItem.7508c887.js";import{o as F}from"./use-timeout.3f01649d.js";import"./QSpinnerDots.4be2227a.js";import"./use-dark.f48971e5.js";let S,N,J=0,C=null,d={},y={};const W={group:"__default_quasar_group__",delay:0,message:!1,html:!1,spinnerSize:80,spinnerColor:"",messageColor:"",backgroundColor:"",boxClass:"",spinner:le,customClass:""},X={...W};function De(e){if(e&&e.group!==void 0&&y[e.group]!==void 0)return Object.assign(y[e.group],e);const t=L(e)===!0&&e.ignoreDefaults===!0?{...W,...e}:{...X,...e};return y[t.group]=t,t}const f=oe({isActive:!1},{show(e){d=De(e);const{group:t}=d;return f.isActive=!0,S!==void 0?(d.uid=J,N.$forceUpdate()):(d.uid=++J,C!==null&&clearTimeout(C),C=setTimeout(()=>{C=null;const a=se("q-loading");S=ae({name:"QLoading",setup(){Q(()=>{F(!0)});function i(){f.isActive!==!0&&S!==void 0&&(F(!1),S.unmount(a),ie(a),S=void 0,N=void 0)}function l(){if(f.isActive!==!0)return null;const r=[w(d.spinner,{class:"q-loading__spinner",color:d.spinnerColor,size:d.spinnerSize})];return d.message&&r.push(w("div",{class:"q-loading__message"+(d.messageColor?` text-${d.messageColor}`:""),[d.html===!0?"innerHTML":"textContent"]:d.message})),w("div",{class:"q-loading fullscreen flex flex-center z-max "+d.customClass.trim(),key:d.uid},[w("div",{class:"q-loading__backdrop"+(d.backgroundColor?` bg-${d.backgroundColor}`:"")}),w("div",{class:"q-loading__box column items-center "+d.boxClass},r)])}return()=>w(ne,{name:"q-transition--fade",appear:!0,onAfterLeave:i},l)}},f.__parentApp),N=S.mount(a)},d.delay)),a=>{if(a===void 0||Object(a)!==a){f.hide(t);return}f.show({...a,group:t})}},hide(e){if(f.isActive===!0){if(e===void 0)y={};else{if(y[e]===void 0)return;{delete y[e];const t=Object.keys(y);if(t.length!==0){const a=t[t.length-1];f.show({group:a});return}}}C!==null&&(clearTimeout(C),C=null),f.isActive=!1}},setDefaults(e){L(e)===!0&&Object.assign(X,e)},install({$q:e,parentApp:t}){e.loading=this,f.__parentApp=t,e.config.loading!==void 0&&this.setDefaults(e.config.loading)}}),Ve=A({props:{hasEdit:{type:Boolean,default:()=>!1}},emit:["v-close-popup"],setup(e,{emit:t}){let a=$("items/regions"),i=$("items/troupes"),l=_({}),r=_(null);const s=$("users"),g=Y.getItem("lesguides_userConnected"),D=async()=>{a.limit.value=[],a.sort.value="nom_region",a.fields.value="*, list_district.*",a.filters.value={deleted:{_eq:!1}},await a.getItems()},V=async()=>{i.item.value=l.value,e.hasEdit?await i.update():(await i.create(),await i.getItems()),t("VClosePopup")},u=()=>e.hasEdit?"Modification de troupe":"Ajout de troupe",z=async(tt,ee,ot)=>{if(console.log("je suis ici"),s.limit.value=50,s.filters.value={_and:[{role:{_eq:g.role}},{id:{_neq:g.id}},{troupe:{districts:l.value.districts.id}},{titre:{niveau:{_gt:3}}}]},s.fields.value="id, avatar, contact, email, first_name, last_name, profession, genre.*, genre.branches.*, genre.branches.grades.*,branche.*, branche.grades.*,grade.*,troupe.*, troupe.districts.*, troupe.districts.list_troupe.*, troupe.districts.regions.*,troupe.districts.regions.list_district.*,troupe.districts.regions.list_district.list_troupe.*,titre.*,situation_matrimonial.* ",await s.getItems(),r.value=s.items.value,console.log("list_user",r.value),r.value!==null){ee();return}};return Q(()=>{D(),e.hasEdit&&(l.value=i.item.value,l.value.regions=i.item.value.districts.regions)}),{stateTroupe:i,formData:l,stateRegion:a,list_user:r,assetsUrl:re,fetchDataUser:z,onSubmit:V,editTitle:u}}}),qe={class:"row"},ke={class:"text-h2 q-py-xs"},Qe={class:"text-bold text-uppercase"};function Ae(e,t,a,i,l,r){return p(),b(K,{class:"my-card",style:{"min-width":"70vw"}},{default:n(()=>[m("section",qe,[o(q,{class:"col-md-4 col-sm-12 flex flex-center bg-green-10 no-padding text-green-2 text-bold"},{default:n(()=>[o(R,{src:"district.jpg","spinner-color":"primary","spinner-size":"82px",height:"100%",fit:"cover"})]),_:1}),o(q,{class:"col-md-8 col-sm-12"},{default:n(()=>[m("div",ke,c(e.editTitle()),1),o(we,{onSubmit:e.onSubmit,onReset:e.onReset,class:""},{default:n(()=>[o(q,{class:"q-gutter-sm"},{default:n(()=>[o(j,{modelValue:e.formData.regions,"onUpdate:modelValue":[t[0]||(t[0]=s=>e.formData.regions=s),t[1]||(t[1]=s=>e.formData.districts=null)],options:e.stateRegion.items.value,"option-value":"options","option-label":"nom_region",label:"R\xE9gion",color:"green-10",class:"bg-green-1 q-pl-sm",style:{"border-radius":"0.8rem"},rounded:"","options-dense":"",borderless:""},null,8,["modelValue","options"]),e.formData.regions?(p(),b(j,{key:0,modelValue:e.formData.districts,"onUpdate:modelValue":t[2]||(t[2]=s=>e.formData.districts=s),options:e.formData.regions.list_district,"option-value":"options","option-label":"nom_district",label:"District",color:"green-10",class:"bg-green-1 q-pl-sm",style:{"border-radius":"0.8rem"},rounded:"",borderless:""},{"no-option":n(()=>[o(U,null,{default:n(()=>[o(I,{class:"text-italic text-grey"},{default:n(()=>[v(" Pas de district disponible ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])):E("",!0),e.formData.districts?(p(),b(j,{key:1,modelValue:e.formData.ct_actuel,"onUpdate:modelValue":t[3]||(t[3]=s=>e.formData.ct_actuel=s),options:e.list_user,label:"Chef(fe) de troupe actuelle",color:"green-10",class:"bg-green-1 q-pl-sm",style:{"border-radius":"0.8rem"},"option-value":"id",onFilter:e.fetchDataUser,"option-label":s=>s===null?"Null value":s.first_name+" "+s.last_name,rounded:"",borderless:""},{"no-option":n(()=>[o(U,null,{default:n(()=>[o(I,{class:"text-italic text-grey"},{default:n(()=>[v(" Aucun membre avec le titre disponible ")]),_:1})]),_:1})]),option:n(s=>[o(U,de(ue(s.itemProps)),{default:n(()=>[o(I,{avatar:""},{default:n(()=>[o(me,{color:"green-1"},{default:n(()=>[s.opt.avatar?(p(),b(R,{key:0,"spinner-color":"white",src:e.assetsUrl+s.opt.avatar+"?fit=cover&width=100&height=100&quality=25"},null,8,["src"])):(p(),b(R,{key:1,src:"icons/boy-scout.png",fit:"cover",ratio:1,width:"40%"}))]),_:2},1024)]),_:2},1024),o(I,null,{default:n(()=>[o(B,null,{default:n(()=>[m("span",Qe,c(s.opt.titre.libelle),1),v(" "+c(s.opt.first_name)+" "+c(s.opt.last_name),1)]),_:2},1024),v(" "+c(s.opt.troupe.districts.regions.nom_region)+" ",1),o(B,{caption:""},{default:n(()=>[v(c(s.opt.troupe.nom_troupe),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter","option-label"])):E("",!0),o(Se,{modelValue:e.formData.nom_troupe,"onUpdate:modelValue":t[4]||(t[4]=s=>e.formData.nom_troupe=s),type:"text",label:"Nom de la troupe",color:"green-10",class:"bg-green-1 q-pl-sm",style:{"border-radius":"0.8rem"},rounded:"",borderless:""},null,8,["modelValue"])]),_:1}),o(G,{align:"right"},{default:n(()=>[o(P,{label:e.hasEdit?"Sauvegarder":"Enregistrer","no-caps":"",unelevated:"",color:"green-10",padding:"sm lg",style:{borderRadius:"0.8rem"},onClick:e.onSubmit},null,8,["label","onClick"]),ce(o(P,{label:"Annuler",outline:"",padding:"sm lg",type:"reset",color:"green-8","no-caps":"",onClick:t[5]||(t[5]=s=>e.formData={}),style:{borderRadius:"0.8rem"}},null,512),[[fe]])]),_:1})]),_:1},8,["onSubmit","onReset"])]),_:1})])]),_:1})}var x=M(Ve,[["render",Ae]]);const Me=A({components:{addComponent:x},props:{item:{type:Object,required:!0}},setup(e){let t=$("items/troupes");const a=_(!1);let i=()=>{a.value=!a.value,t.item.value=e.item};return Q(async()=>{}),{onEdit:i,editShow:a}}});function Ie(e,t,a,i,l,r){const s=h("add-component");return p(),k(O,null,[o(P,{flat:"",icon:"o_edit",color:"green-10",onClick:e.onEdit},null,8,["onClick"]),o(H,{modelValue:e.editShow,"onUpdate:modelValue":t[1]||(t[1]=g=>e.editShow=g)},{default:n(()=>[o(s,{hasEdit:"",onVClosePopup:t[0]||(t[0]=g=>e.editShow=!e.editShow)})]),_:1},8,["modelValue"])],64)}var Pe=M(Me,[["render",Ie]]);const Te=A({components:{editComponent:Pe,deleteBtnComponent:ve},props:{item:{type:Object,required:!0}},setup(e){const t=$("items/troupes"),a=$("users");let i=_(0);const l=_(!1),r=_(!1);let s=_({days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],daysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],months:["Janvier","Fevrier","Mars","Avril","Mai","Juin","Juillet","Ao\xFBt","Septembre","Octobre","Novembre","D\xE9cembre"],monthsShort:["Jan","Fev","Mar","Avr","Mai","Ju","Juil","Ao\xFBt","Sept","Oct","Nov","Dec"]});const g=u=>{t.item=u,l.value=!l.value},D=u=>{t.item=u,r.value=!r.value};let V=async()=>{console.log("id de la troupe ",e.item.id),a.filters.value={_and:[{troupe:e.item.id},{deleted:!1}]},i.value=await a.count()};return Q(()=>{V()}),{editItem:g,showDeleted:r,editShow:l,deleteItem:D,date:_e,options:s,totalMembre:i}}}),Re={class:"text-h5"},je={key:0,class:"text-subtitle col-6"},Ue={class:"text-uppercase"},Ne={key:1},Ee={class:"row text-center"},Oe={class:"text-subtitle2 col-4"},ze={class:"text-subtitle2 col-4"},Be={class:"text-subtitle2 col-4"},Fe={class:"row text-grey-8 text-weight-thin items-center q-pl-sm text-italic"};function Je(e,t,a,i,l,r){const s=h("edit-component"),g=h("delete-btn-component");return p(),b(K,{class:"my-card q-pa-xs",flat:"",style:{"border-radius":"0.8rem"}},{default:n(()=>[o(q,{class:"q-gutter-y-sm"},{default:n(()=>[o(q,{class:"text-center"},{default:n(()=>[m("div",Re,c(e.item.nom_troupe),1),e.item.ct_actuel?(p(),k("div",je,[m("span",Ue,c(e.item.ct_actuel.titre.libelle),1),v(" "+c(e.item.ct_actuel.last_name),1)])):(p(),k("div",Ne,"-"))]),_:1}),m("div",Ee,[m("div",Oe,[o(T,{name:"r_fort",size:"sm"}),v(" : "+c(e.item.districts?e.item.districts.regions.nom_region:"-"),1)]),m("div",ze,[o(T,{name:"r_signpost",size:"sm"}),v(" : "+c(e.item.districts?e.item.districts.nom_district:"-"),1)]),m("div",Be,[o(T,{name:"r_groups_2",size:"sm"}),v(" : "+c(e.totalMembre),1)])])]),_:1}),m("div",Fe,[v(c(e.date.formatDate(e.item.date_created,"D MMMM YYYY",e.options))+" ",1),o(Z),o(G,{align:"right"},{default:n(()=>[o(s,{item:e.item},null,8,["item"]),o(g,{model:"items/troupes",libelle:e.item.nom_troupe,item:e.item},null,8,["libelle","item"])]),_:1})])]),_:1})}var Le=M(Te,[["render",Je]]);const Ye=A({components:{itemComponent:Le,AddComponent:x,SearchComponent:be,SortableButtonsComponent:he},setup(){const e=_(!1);let t=$("items/troupes");_();let a=_(1),i=()=>Math.ceil(t.totalItem.value/9);const l=async()=>{t.limit.value=9,t.fields.value="*,districts.*,districts.regions.*, districts.regions.list_district.*, ct_actuel.*, ct_actuel.titre.* ",t.sort.value="-date_created",t.filters.value={deleted:{_eq:!1}},t.page.value=a.value,await t.getItems(),i()},r=async()=>{await l(),e.value=!1};let s=async()=>{await t.getItems()};return Q(()=>{l()}),{addComponentHide:r,paginationCount:i,stateTroupe:t,pagination:s,addShow:e}}}),Ge={class:"q-mt-md no-padding"},He={class:"text-h6"},Ze={class:"row q-px-xs q-gutter-x-sm"},Ke={class:"row"};function We(e,t,a,i,l,r){const s=h("sortable-buttons-component"),g=h("search-component"),D=h("item-component"),V=h("add-component");return p(),k(O,null,[m("section",Ge,[m("div",He," List des troupes ( "+c(e.stateTroupe.totalItem.value)+" ) ",1),m("div",Ze,[o(P,{class:"rounded-borders",unelevated:"",color:"green-6","no-caps":"",icon:"r_add",label:"Ajouter",padding:"sm md",onClick:t[0]||(t[0]=u=>e.addShow=!e.addShow)}),o(s,{model:"items/troupes",sortedField:"nom_troupe"}),o(Z),o(g,{model:"items/troupes",filterField:"nom_troupe",libelle:"Rechercher une troupe"}),e.paginationCount()>1?(p(),b(Ce,{key:0,unelevated:"","active-design":"unelevated","active-color":"green-5",color:"green-2",modelValue:e.stateTroupe.page.value,"onUpdate:modelValue":[t[1]||(t[1]=u=>e.stateTroupe.page.value=u),t[2]||(t[2]=u=>e.pagination())],"boundary-numbers":!1,"max-pages":5,max:e.paginationCount()},null,8,["modelValue","max"])):E("",!0)]),o($e,{class:"q-mt-sm",style:{height:"79vh"}},{default:n(()=>[m("template",Ke,[(p(!0),k(O,null,pe(e.stateTroupe.items.value,u=>(p(),b(ye,{key:u.id,once:"",class:"col-md-4 col-sm-6 col-lg-4 q-pa-sm",transition:"scale"},{default:n(()=>[o(D,{item:u,onVClosePopup:t[3]||(t[3]=z=>e.addComponentHide())},null,8,["item"])]),_:2},1024))),128))])]),_:1})]),o(H,{modelValue:e.addShow,"onUpdate:modelValue":t[5]||(t[5]=u=>e.addShow=u)},{default:n(()=>[o(V,{onVClosePopup:t[4]||(t[4]=u=>e.addShow=!e.addShow)})]),_:1},8,["modelValue"])],64)}var Xe=M(Ye,[["render",We]]);const xe=A({components:{itemsComponent:Xe},name:"troupePage",setup(){const e=ge();Y.has("lesguides_userConnected")||e.push("/")}});function et(e,t,a,i,l,r){const s=h("items-component");return p(),b(te,{padding:""},{default:n(()=>[o(s)]),_:1})}var ct=M(xe,[["render",et]]);export{ct as default};
